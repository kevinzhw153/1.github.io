<!doctype html>
<html>
<head>

	
	<title>首页 - Kevin 的博客 | 呃呃呃</title>
	<meta charset="utf-8">
	<!-- 以下为导入 4.x 版本配套的 CSS，为了兼容 3.x 请使用不加 -v4 的 CSS-->
	<link rel="stylesheet" type="text/css" href="./style/allcss-v4.css">
	<link rel="stylesheet" type="text/css" href="./style/divcss-v4.css">
	<link rel="stylesheet" type="text/css" href="./style/decocss-v4.css">
	<!-- font-awesome 图标库-->
	<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
	<!-- -->
	<a href="https://count.58q.com/" target="_blank"><img src="https://count.58q.com/hit.php?id=yevmffp&nd=9&style=2" border="0" alt="网站计数器"></a>
<script async src="https://cse.google.com/cse.js?cx=017814980032632389432:xurynbeuhdq"></script>
<div class="gcse-search"></div>
	
	<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-173251435-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-173251435-1');
</script>

	<script src="./src.html"></script>

        <link rel="icon" type="image/ico" href="./img/!icon-bird.ico"/>	
<?php
/**
 * template name: 投稿
 * website demo : http://blog.mimvp.com
 * description: template for mimvp.com
 * author : yanggang
 * date   : 2015-11-20
 */
 
if( isset($_POST['tougao_form']) && $_POST['tougao_form'] == 'mimvp_auto_post'){
    if( isset($_COOKIE["tougao"]) && ( time() - $_COOKIE["tougao"] ) < 120 ){
        wp_die('您投稿也太勤快了吧，先歇会儿！');
    }
    print_r($_POST);
    //表单变量初始化
    $authorname = isset( $_POST['tougao_authorname'] ) ? $_POST['tougao_authorname'] : '';
    $email = isset( $_POST['tougao_authoremail'] ) ? $_POST['tougao_authoremail'] : '';
    $blog = isset( $_POST['tougao_authorblog'] ) ? $_POST['tougao_authorblog'] : '';
    $title = isset( $_POST['tougao_title'] ) ? $_POST['tougao_title'] : '';
    $tags = isset( $_POST['tougao_tags'] ) ? $_POST['tougao_tags'] : '';
    $category = isset( $_POST['tougao_cat'] ) ? $_POST['tougao_cat'] : '4766';
    $postdate = isset( $_POST['tougao_date'] ) ? $_POST['tougao_date'] : date("Y-m-d H:i:s", strtotime("+8 hour"));
    $content = isset( $_POST['tougao_content'] ) ? $_POST['tougao_content'] : '';
 
    $category_list = explode(",", $category);
    //    $category_list = array("4924","1798","783","771");
 
/*
    echo $postdate;
    //表单项数据验证
    if ( empty($authorname) || strlen($authorname) > 20 ){
        wp_die('昵称必须填写，且不得超过20个长度');
    }
    if ( empty($email) || strlen($email) > 60 || !preg_match("/^([a-z0-9\+_\-]+)(\.[a-z0-9\+_\-]+)*@([a-z0-9\-]+\.)+[a-z]{2,6}$/ix", $email)){
        wp_die('邮箱必须填写，且不得超过60个长度，必须符合email格式');
    }
    if ( empty($title) || strlen($title) > 100 ){
        wp_die('文章标题必须填写，且不得超过100个长度');
    }
    if ( empty($content) || strlen($content) < 100){
        wp_die('内容必须填写，且不得少于100个长度');
    }
 */
 
    $tougao = array('post_title' => $title,
        'post_content' => $content,
        'post_status' => 'publish',
        'tags_input' => $tags,
        'post_date' => $postdate,
        // 'post_category' => array($category));
        'post_category' => $category_list);
 
    // 将文章插入数据库
    $status = wp_insert_post( $tougao );               
    if ($status != 0){
        global $wpdb;
        $myposts = $wpdb->get_results("SELECT ID FROM $wpdb->posts WHERE post_status = 'publish' AND post_type = 'post' ORDER BY post_date DESC");
        add_post_meta($myposts[0]->ID, 'tcp_postauthor', $authorname);  //插入投稿人昵称的自定义域
        if( !empty($blog))
            add_post_meta($myposts[0]->ID, 'tcp_posturl', $blog);       //插入投稿人网址的自定义域
        setcookie("tougao", time(), time()+180);
        wp_die('投稿成功！','投稿成功！');
    }else{
        wp_die('投稿失败！','投稿失败！');
    }
}
 
get_header();
?>
 
<?php get_sidebar(); ?>
 
<body>
<script type="text/javascript" src="<?php bloginfo('template_url'); ?>/kindeditor/kindeditor-min.js"></script>
<script type="text/javascript" src="<?php bloginfo('template_url'); ?>/kindeditor/lang/zh_CN.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    var editor;
    KindEditor.ready(function(K) {
        editor = K.create('textarea[name="tougao_content"]', {
            allowFileManager : false,
                allowImageUpload : false
        });
    });
});
</script>
<?php if (have_posts()) : ?>
<?php while (have_posts()) : the_post(); ?>
<?php include('top.php'); ?>
<div id="wrapper" class="clearfix">
<div id="navigation">
<div class="navigation">
<h2><a title="<?php the_title(); ?>"><?php the_title(); ?></a></h2>
</div>
<?php include("includes/notice.php"); ?>
</div>
<div class="tougao divmargin">
 
<div class="entry">
 
<form method="post" action="<?php echo $_SERVER["REQUEST_URI"]; $current_user = wp_get_current_user(); ?>">
<div id="basicinfo">
 
<table style="width: 700px; line-height: 30px; font-size: 16px;">
<tr>
<td style="width: 75px; text-align: right; padding-right: 10px;">昵称:</td>
<td>
<input type="text" style="width: 200px;" name="tougao_authorname" value="<?php if ( 0 != $current_user->ID ) echo $current_user->user_login; ?>" />
<small>*</small>
</td>
</tr>
 
<tr>
<td style="width: 75px; text-align: right; padding-right: 10px;">E-Mail:</td>
<td>
<input type="text" style="width: 200px;" name="tougao_authoremail" value="<?php if ( 0 != $current_user->ID ) echo $current_user->user_email; ?>" />
<small>*</small>
</td>
</tr>
 
<tr>
<td style="width: 75px; text-align: right; padding-right: 10px;">您的网站:</td>
<td>
<input type="text" style="width: 200px;" name="tougao_authorblog" value="<?php if ( 0 != $current_user->ID ) echo $current_user->user_url; ?>" />
</td>
</tr>
 
<tr>
<td style="width: 75px; text-align: right; padding-right: 10px;">文章标题:</td>
<td>
<input type="text" style="width: 200px;" name="tougao_title" value="" />
<small>*</small>
</td>
</tr>
 
 
<tr>
<td style="width: 75px; text-align: right; padding-right: 10px;">关键字:</td>
<td>
<input type="text" style="width: 200px;" value="" name="tougao_tags" />
<small>*</small>
</td>
</tr>
 
<tr>
<td style="width: 75px; text-align: right; padding-right: 10px;">文章分类:</td>
<td>
<?php //wp_dropdown_categories('show_count=1&hierarchical=1'); ?>
<?php wp_dropdown_categories('title_li=0&hierarchical=1'); ?>
<small>*</small>
</td>
</tr>
 
</div>
 
<tr>
<td colspan="2">
文章内容:(必须)
</td>
</tr>
 
<tr>
<td colspan="2">
<div class="post-area">
<textarea rows="15" cols="60" id="tougao_content" name="tougao_content"></textarea>
</div>
</td>
</tr>
 
<tr>
<td>发布密码:</td>
<td>
<input type="password" style="width: 200px;" value="123456" name="tougao_form" />
<small>*</small>
</td>
</tr>
 
 
<tr>
<td colspan="2">
<input id="submit" name="submit" type="submit" value="提交" />
&nbsp;&nbsp;&nbsp;
<input id="reset" name="submit" type="reset" value="重填" />
</td>
</tr>
 
</table>
 
 
</form>
 
</div>
</div>
</div>
<?php endwhile; else: ?>
<?php endif; ?>
<?php get_footer(); ?>
	

	<script src="./script/showFooter.js"></script>
</body>
</html>
